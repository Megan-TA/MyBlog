<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>huangchen的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="huangchen的个人博客">
<meta property="og:url" content="https://megan-ta.github.io/page/3/index.html">
<meta property="og:site_name" content="huangchen的个人博客">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="huangchen">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/MyBlog/atom.xml" title="huangchen的个人博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/MyBlog/favicon.png">
  
  
  
<link rel="stylesheet" href="/MyBlog/css/style.css">

  
    
<link rel="stylesheet" href="/MyBlog/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/MyBlog/" id="logo">huangchen的个人博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/MyBlog/">Home</a>
        
          <a class="main-nav-link" href="/MyBlog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/MyBlog/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://megan-ta.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-前端基础面试题整理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/11/12/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T02:15:59.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/11/12/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/">前端基础面试题整理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="js-基础"><a href="#js-基础" class="headerlink" title="js 基础"></a>js 基础</h2><ul>
<li>闭包</li>
</ul>
<p>一个函数内部返回一个能访问外部变量的函数</p>
<ul>
<li>作用域</li>
<li>原型链</li>
<li>变量提升</li>
<li>函数参数值传递</li>
<li>this 指向问题</li>
<li>函数提升以及优先级问题</li>
<li>new 操作符做了什么？</li>
</ul>
<ol>
<li>创建一个空对象，作为将要返回的对象实例；</li>
<li>将这个空对象的原型对象指向构造函数的 prototype 属性对象；</li>
<li>调用构造器， 将这个实例对象的值赋值给函数内部的 this 对象；</li>
<li>执行构造函数内的逻辑；</li>
<li>如果构造函数返回值是对象则返回这个对象，如果不是对象则返回新的实例对象；</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">showId</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">id</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// new内部实现</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myNew</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">Constructor</span> = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">// 实现继承，实例可以访问构造器的属性</span></span><br><span class="line">  o.<span class="property">__proto__</span> = <span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  <span class="comment">// 调用构造器，并改变其 this 指向到实例</span></span><br><span class="line">  <span class="keyword">var</span> ret = <span class="title class_">Constructor</span>.<span class="title function_">call</span>(o, <span class="variable language_">arguments</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> ret === <span class="string">&quot;object&quot;</span> &amp;&amp; ret !== <span class="literal">null</span> ? ret : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="title function_">myNew</span>(A, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>用 ES5 实现一个继承（有哪些方式）</li>
</ul>
<ol>
<li>类继承</li>
<li>原型继承</li>
<li>组合继承</li>
<li>寄生继承</li>
</ol>
<ul>
<li>0.2+0.1 不等于 0.3 问题（浮点数精度）</li>
<li>堆、栈、队列是什么？都有什么区别？有什么应用？</li>
<li>深拷贝、浅拷贝问题（immutable 是怎么实现的？）</li>
<li>typed array 问题</li>
<li>es6 箭头函数问题</li>
<li>let var const 区别与原理</li>
</ul>
<ol>
<li>var 存在变量提升，执行时已经完成声明与初始化，全局作用域|函数作用域；</li>
<li>let const 不能重复定义，存在暂时性死区，没有变量提升，块作用域；</li>
<li>var 在栈内存预分配空间，等执行时候再将变量值存在空间里，let const 不会</li>
</ol>
<ul>
<li>什么是 iterator？for of 用过吗？</li>
<li>call、apply、bind 区别，bind 怎么实现的？</li>
</ul>
<p>参考链接：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/59093b1fa0bb9f006517b906">JavaScript 深入之 bind 的模拟实现</a></li>
</ol>
<ul>
<li>promise 实现，Promise.all 实现， Promise.race，Promise.finally 实现</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_Promise</span>(<span class="params">handle</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;pending&quot;</span>;</span><br><span class="line">  <span class="comment">// 存放成功的值</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// 存放失败的值</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">successStore</span> = []</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">failStore</span> = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;pending&quot;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;resolved&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">successStore</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fnc</span> =&gt;</span> <span class="title function_">fnc</span>())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;pending&quot;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;rejected&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">failStore</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fnc</span> =&gt;</span> <span class="title function_">fnc</span>())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title function_">handle</span>(resolve, reject);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">reject</span>(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_Promise.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">  <span class="comment">// 处理异步的情况（如setTimeout）</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">successStore</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>))</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">failStore</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">value</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;resolved&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;rejected&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO  then链式调用</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_Promise.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">all</span> = <span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> len = arr.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> resultArr = []</span><br><span class="line">  <span class="comment">// 记录成功的数量</span></span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">let</span> i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      arr[i].<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">       resultArr[i] = res</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (count == len) &#123;</span><br><span class="line">         <span class="title function_">resolve</span>(resultArr)</span><br><span class="line">        &#125;</span><br><span class="line">        count++</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">_Promise.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">race</span> = = <span class="keyword">function</span>(<span class="params">iterable</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> iterable) &#123;</span><br><span class="line">      <span class="keyword">const</span> v = iterable[i];</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> v === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> v.<span class="property">then</span> === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        v.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(v);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">_Promise.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">finally</span> = <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> P = <span class="variable language_">this</span>.<span class="property">constructor</span>; <span class="comment">// 获取当前实例构造函数的引用</span></span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(</span><br><span class="line">    <span class="function"><span class="params">value</span> =&gt;</span> P.<span class="title function_">resolve</span>(<span class="title function_">callback</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> value),</span><br><span class="line">    <span class="function"><span class="params">reason</span> =&gt;</span></span><br><span class="line">      P.<span class="title function_">resolve</span>(<span class="title function_">callback</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> reason;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(resolve, <span class="number">200</span>, <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(resolve, <span class="number">100</span>, <span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">race</span>([p1, p2]).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>参考资料：<br><a target="_blank" rel="noopener" href="https://juejin.im/post/5afd2ff26fb9a07aaa11786c">前端工程师必知之 Promise 的实现</a></p>
<ul>
<li>caller、callee 了解吗？什么时候会用到？建议用吗？</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">factorial</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x &lt;= <span class="number">1</span> ? <span class="number">1</span> : x * <span class="title function_">factorial</span>(x - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// callee</span></span><br><span class="line"><span class="comment">// callee是arguments对象的一个属性，指向 arguments 对象的函数</span></span><br><span class="line"><span class="comment">// 利用callee</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">factorial</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x &lt;= <span class="number">1</span> ? <span class="number">1</span> : x * <span class="variable language_">arguments</span>.<span class="title function_">callee</span>(x - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// caller</span></span><br><span class="line"><span class="comment">// 函数对象的一个属性，指向调用当前函数的函数。比如 A() 调用 B()， 则在B()中 B.caller 指向A()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1 这个属性只有当函数在执行时才有用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 如果在JavaScript程序中，函数是由顶层调用的，则返回null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">B</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(B.<span class="property">caller</span>); <span class="comment">// B</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">B</span>(); <span class="comment">// A</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<ul>
<li>async await 知识点（await 的作用，async 返回的是什么）</li>
</ul>
<p>很多人以为 await 会一直等待之后的表达式执行完之后才会继续执行后面的代码，实际上 await 是一个让出线程的标志。await 后面的表达式会先执行一遍，将 await 后面的代码加入到 microtask 中，然后就会跳出整个 async 函数来执行后面的代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">async2</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">async2</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Async&#x2F;Await 如何通过同步的方式实现异步?</li>
</ul>
<p>Async&#x2F;Await 就是一个自执行的 generate 函数。利用 generate 函数的特性把异步的代码写成“同步”的形式，generate 函数本身实现思想来源于单向链表。</p>
<ul>
<li>generator 又是什么？</li>
</ul>
<p>生成器 generator 函数执行时返回这个生成器的迭代对象，当这个迭代对象的 next 方法被调用时，遇到 yield 的位置停止，yield 后返回的值就是迭代器要返回的值。如果用的是 yield *（多了个星号），则表示将执行权移交给另一个生成器函数（当前生成器暂停执行），调用 next() （再启动）方法时，如果传入了参数，那么这个参数会作为上一条执行的 yield 语句的返回值，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">another</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;人月神话&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span>* <span class="title function_">another</span>(); <span class="comment">// 移交执行权</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="keyword">yield</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> b = <span class="keyword">yield</span> a; <span class="comment">// a=&#x27;world&#x27; 是 next(&#x27;world&#x27;) 传参赋值给了上一个 yidle &#x27;hello&#x27; 的左值</span></span><br><span class="line">  <span class="keyword">yield</span> b; <span class="comment">// b=！ 是 next(&#x27;！&#x27;) 传参赋值给了上一个 yidle a 的左值</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> g = <span class="title function_">gen</span>();</span><br><span class="line">g.<span class="title function_">next</span>(); <span class="comment">// &#123;value: &quot;人月神话&quot;, done: false&#125;</span></span><br><span class="line">g.<span class="title function_">next</span>(); <span class="comment">// &#123;value: &quot;hello&quot;, done: false&#125;</span></span><br><span class="line">g.<span class="title function_">next</span>(<span class="string">&quot;world&quot;</span>); <span class="comment">// &#123;value: &quot;world&quot;, done: false&#125; 将 &#x27;world&#x27; 赋给上一条 yield &#x27;hello&#x27; 的左值，即执行 a=&#x27;world&#x27;，</span></span><br><span class="line">g.<span class="title function_">next</span>(<span class="string">&quot;!&quot;</span>); <span class="comment">// &#123;value: &quot;!&quot;, done: false&#125; 将 &#x27;!&#x27; 赋给上一条 yield a 的左值，即执行 b=&#x27;!&#x27;，返回 b</span></span><br><span class="line">g.<span class="title function_">next</span>(); <span class="comment">// &#123;value: undefined, done: false&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>v8 线程模型、event loop（async、promise、nextTick、setTimeout、- setImmediate 经典问题变着花样考）</p>
</li>
<li><p>进程和线程是什么？有什么区别？</p>
</li>
<li><p>v8 垃圾回收机制</p>
</li>
<li><p>输入 URL，浏览器的执行过程又是怎么样的？（浏览器解析方式、顺序，async、- defer 等）</p>
</li>
<li><p>了解前端模块化吗？有几种规范？（commonjs 和 es module 都是怎么实现- 的？有啥区别？）</p>
</li>
</ul>
<ul>
<li><p>按需加载实现</p>
</li>
<li><p>[‘1’, ‘2’, ‘3’].map(parseInt) parseInt(100, 2) &#x3D; 4</p>
</li>
<li><p>防抖节流</p>
</li>
</ul>
<ol>
<li>防抖<blockquote>
<p>高频事件 n 秒内执行一次，如果 n 秒内再次触发，重新计时，即最后一次触发</p>
</blockquote>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debonce</span>(<span class="params">fn, time</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timeout = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">    timeout = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;, time);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>节流<blockquote>
<p>高频事件 n 秒内执行一次</p>
</blockquote>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debonce</span>(<span class="params">fn, time</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> startTime = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> nowTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">if</span> (nowTime - startTime &gt;= time) &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">      startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Set WeaksSet 和 Map WeakMap 各自区别</p>
<p>Set 无序类似数组的数据结构</p>
<p>WeakSet</p>
<ol>
<li>只能是对象引用；</li>
<li>未使用会被 GC 收集</li>
</ol>
<p>Map 字典结构，以<code>value:value</code>形式存储</p>
<p>WeakMap</p>
<ol>
<li>建的对象引用只能是对象引用；</li>
<li>未使用的建对象会被 GC 收集</li>
</ol>
</li>
<li><p>es5 和 es6 类的区别</p>
<ol>
<li>class 会提升，但不会赋值，会进入暂时性死区（TDZ）；</li>
<li>class 内部默认启用严格模式；</li>
<li>class 的所有方法、属性不能枚举；</li>
<li>class 所有方法没有 prototype，也没有[[constructor]]，不能实例化；</li>
<li>必须使用<code>new</code>来实例化；</li>
<li>class 无法重写类名；</li>
</ol>
</li>
<li><p>es5 和 es6 的继承区别</p>
<ol>
<li>es5 的继承是先实例化子类，再通过父类构造函数修饰子类实例，而 es6 的继承是通过<code>super</code>方法先实例化父类，再通过子类构造函数修饰父类实例；</li>
<li>es6 的子类可以通过<code>__proto__</code>找到父类，而 es5 中通过<code>__proto__</code>只能找到<code>Function.prototype</code></li>
</ol>
</li>
<li><p>箭头函数和普通函数区别</p>
</li>
</ul>
<ol>
<li>箭头函数本身没有 this，需要通过原型向上级对象查找，即 this 对象是指向定义是所在作用域的 this 对象（因此无法使用 call、apply、bind 绑定 this 值），普通函数指向调用时的对象；</li>
<li>箭头函数没有 arguments，可以用 rest 参数代替；</li>
<li>箭头函数不能使用 new 命令，</li>
</ol>
<ul>
<li>因为没有 this，无法调用 call；</li>
<li>没有 prototype</li>
</ul>
<ol start="4">
<li>箭头函数没有原型 prototype；</li>
</ol>
<hr>
<h2 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h2><ol>
<li>说说浏览器和 Node 事件循环的区别</li>
</ol>
<p>微任务和宏任务在 Node 的执行顺序</p>
<p>Node 10 及以前：</p>
<p>执行完一个阶段（timers、I&#x2F;O、poll 等）的宏任务<br>才会去执行 nextTick 队列里面的内容<br>然后再执行完微任务队列的内容</p>
<p>Node 11 以后： 和浏览器的行为统一了，都是每执行完一个宏任务就会执行微任务队列。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/1/12/16841bad1cda741f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Node的Event Loop"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children2&quot;</span>);</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children2-1&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children3&quot;</span>);</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children3-1&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children1&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上代码在node11以下版本的执行结果(先执行所有的宏任务，再执行微任务)</span></span><br><span class="line"><span class="comment">// start</span></span><br><span class="line"><span class="comment">// end</span></span><br><span class="line"><span class="comment">// children1</span></span><br><span class="line"><span class="comment">// children2</span></span><br><span class="line"><span class="comment">// children3</span></span><br><span class="line"><span class="comment">// children2-1</span></span><br><span class="line"><span class="comment">// children3-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上代码在node11及浏览器的执行结果(顺序执行宏任务和微任务)</span></span><br><span class="line"><span class="comment">// start</span></span><br><span class="line"><span class="comment">// end</span></span><br><span class="line"><span class="comment">// children1</span></span><br><span class="line"><span class="comment">// children2</span></span><br><span class="line"><span class="comment">// children2-1</span></span><br><span class="line"><span class="comment">// children3</span></span><br><span class="line"><span class="comment">// children3-1</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="前端内功"><a href="#前端内功" class="headerlink" title="前端内功"></a>前端内功</h3><ol>
<li>模块化理解；</li>
</ol>
<blockquote>
<p>模块化是为了处理全局污染、隔离作用域、抽离公共代码等问题</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td><code>iife</code></td>
<td>自执行 函数作用域</td>
</tr>
<tr>
<td><code>amd</code></td>
<td>浏览器端（requirejs） 依赖前置</td>
</tr>
<tr>
<td><code>cmd</code></td>
<td>浏览器端（seajs） 运行时加载依赖 后面也支持依赖前置</td>
</tr>
<tr>
<td><code>commonjs</code></td>
<td>浏览器、服务器通用 运行时加载 第一次运行加载，缓存值，值的浅拷贝</td>
</tr>
<tr>
<td><code>es6 module</code></td>
<td>浏览器、服务器通用 静态编译，编译时输出接口 值的引用</td>
</tr>
</tbody></table>
<ol start="2">
<li>工程化理解；<br>web业务日益复杂化和多元化，后端直出的模式转变为前后分离，多页应用想spa、ssr发展。前端工程复杂产生很多问题。<ul>
<li>如何高效多人协作？</li>
<li>如何保证项目可维护性？</li>
<li>如何提高项目开发质量？</li>
<li>如何降低项目生产风险？</li>
</ul>
</li>
</ol>
<p>  主要目的是为了 提高效率和降低成本。<br>  前端工程化主要包括 模块化、组件化、规范化、自动化四个角度。</p>
<p>  模块化<br>    - js模块化<br>    - css模块化 （BEM、css in js）<br>    - 资源模块化 （webpack）<br>  组件化<br>    - html+js+css功能完备的结构单元就是组件<br>    - 模块复用、扩展、继承、嵌套等<br>    - 手动操作dom &#x3D;&gt; 数据驱动（vue、react）<br>  规范化<br>    - 项目结构 （cli）<br>    - 编码规范（eslint）<br>    - 文档规划<br>    - 组件管理<br>    - Git分支管理、commit描述管理<br>  自动化<br>    - 持续集成（jinkens）<br>    - 自动化构建（webhooks）<br>    - 自动化部署<br>    - 自动化测试</p>
<ol start="3">
<li>组件化理解;</li>
<li>性能优化</li>
</ol>
<ul>
<li>图片<ul>
<li>雪碧图</li>
<li>图片懒加载、oss动态裁剪、webP格式、减少80%流量</li>
</ul>
</li>
<li>网络层<ul>
<li>页面跳转前接口预请求；快200ms；</li>
<li>http2</li>
<li>GZIP</li>
</ul>
</li>
<li>缓存<ul>
<li>核心页面部分非关键数据放缓存，缓存优先；</li>
</ul>
</li>
<li>编译<ul>
<li>tree-shaking</li>
</ul>
</li>
<li>动画<ul>
<li>RAF</li>
</ul>
</li>
<li>其他<ul>
<li>页面、组件懒加载</li>
<li>分包</li>
<li>滚动加载</li>
<li>PWA</li>
<li>骨架屏</li>
</ul>
</li>
</ul>
<hr>
<h3 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h3><ol>
<li>React 中的 setState 何时是同步的，何时是异步的？</li>
</ol>
<p>在 React 中，如果是由 React 引发的事件处理（比如通过 onClick 引发的事件处理，生命周期函数等），调用 setState 不会同步更新 this.state，除此之外的 setState 调用会同步执行 this.state。所谓“除此之外”，指的是绕过 React 通过 addEventListener 直接添加的事件处理函数，还有通过 setTimeout&#x2F;setInterval 产生的异步调用。</p>
<p><strong>原因：</strong> 在 React 的 setState 函数实现中，会根据一个变量<code>isBatchingUpdate</code>·判断是直接更新 this.state 还是放到队列中回头再说，而<code>isBatchingUpdates</code>默认是<code>false</code>，也就表示 setState 会同步更新 this.state，但是，有一个函数 batchedUpdates，这个函数会把 isBatchingUpdates 修改为 true，而当 React 在调用事件处理函数之前就会调用这个 batchedUpdates，造成的后果，就是由 React 控制的事件处理过程 setState 不会同步更新 this.state。</p>
<ol start="2">
<li>vue 父组件和子组件创建的生命周期顺序</li>
</ol>
<ul>
<li><p>加载渲染过程 父 beforeCreate-&gt;父 created-&gt;父 beforeMount-&gt;子 beforeCreate-&gt;子 created-&gt;子 beforeMount-&gt;子 mounted-&gt;父 mounted</p>
</li>
<li><p>子组件更新过程 父 beforeUpdate-&gt;子 beforeUpdate-&gt;子 updated-&gt;父 updated</p>
</li>
<li><p>父组件更新过程 父 beforeUpdate-&gt;父 updated</p>
</li>
<li><p>销毁过程 父 beforeDestroy-&gt;子 beforeDestroy-&gt;子 destroyed-&gt;父 destroyed</p>
</li>
</ul>
<hr>
<h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><h3 id="介绍下-BFC-及其应用"><a href="#介绍下-BFC-及其应用" class="headerlink" title="介绍下 BFC 及其应用"></a>介绍下 BFC 及其应用</h3><p>BFC 块级格式上下文， 是指一个独立的渲染区域或者说是一个隔离的独立容器。</p>
<p>形成条件：</p>
<p>1、float浮动；</p>
<p>2、绝对定位；</p>
<p>3、display 为以下其中之一的值 inline-block，table-cell，table-caption；</p>
<p>4、overflow 除了 visible 以外的值（hidden，auto，scroll）；</p>
<p>特点：</p>
<p>1.内部的 Box 会在垂直方向上一个接一个的放置。</p>
<p>2.垂直方向上的距离由 margin 决定，垂直外边距会重叠即两个盒子中间距离以 margin 最大的值决定；</p>
<p>3.bfc 的区域不会与 float 的元素区域重叠。</p>
<p>4.计算 bfc 的高度时，浮动元素也参与计算</p>
<p>5.bfc 就是页面上的一个独立容器，容器里面的子元素不会影响外面元素。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chen-cong/p/7862832.html">CSS 中的 BFC 详解</a></p>
<h3 id="position-几种属性"><a href="#position-几种属性" class="headerlink" title="position 几种属性"></a>position 几种属性</h3><ul>
<li>relative 相对定位</li>
</ul>
<p>不脱离文档流<br>设置定位<br>层级</p>
<ul>
<li>absolute 绝对定位</li>
</ul>
<p>脱离文档流<br>设置定位<br>层级</p>
<ul>
<li><p>fixed 浏览器窗口定位</p>
</li>
<li><p>sticky</p>
</li>
</ul>
<p>页面滑动距离未超过指定距离为相对定位，超过为 fixed 定位</p>
<ul>
<li><p>static 默认定位</p>
</li>
<li><p>inherit 继承定位</p>
</li>
</ul>
<p>从父元素继承 position 属性的值</p>
<h3 id="相邻的两个-inline-block-节点为什么会出现间隔，该如何解决"><a href="#相邻的两个-inline-block-节点为什么会出现间隔，该如何解决" class="headerlink" title="相邻的两个 inline-block 节点为什么会出现间隔，该如何解决"></a>相邻的两个 inline-block 节点为什么会出现间隔，该如何解决</h3><p>元素被当成行内元素排版的时候，原来 HTML 代码中的回车换行被转成一个空白符，在字体不为 0 的情况下，空白符占据一定宽度，所以 inline-block 的元素之间就出现了空隙。这些元素之间的间距会随着字体的大小而变化，当行内元素 font-size:16px 时，间距为 8px。</p>
<p>解决办法如下：</p>
<ul>
<li>font-size</li>
<li>html 不换行</li>
<li>word-spacing</li>
</ul>
<h2 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h2><h3 id="input-v-model-是什么简写；"><a href="#input-v-model-是什么简写；" class="headerlink" title="input v-model 是什么简写；"></a>input v-model 是什么简写；</h3><input :value="value" :input="$emit('input', value)">

<h3 id="将原生事件绑定到组件"><a href="#将原生事件绑定到组件" class="headerlink" title="将原生事件绑定到组件"></a>将原生事件绑定到组件</h3><p>v-on配合.native修饰符不生效，利用$listeners对象，包含在这个组件上所有的监听器</p>
<h3 id="插槽作用域；"><a href="#插槽作用域；" class="headerlink" title="插槽作用域；"></a>插槽作用域；</h3><slot v-slot="scope">

<h3 id="指令；"><a href="#指令；" class="headerlink" title="指令；"></a>指令；</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// 只调用一次 ， 指定第一次绑定到元素时调用。</span></span><br><span class="line">  <span class="comment">// &#123; name, value, oldValue, expression, arg, modifiers &#125;</span></span><br><span class="line">  <span class="title function_">bind</span>(<span class="params">el, binding, vnode, oldVnode</span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">inserted</span>(<span class="params">el</span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 所在组件的 VNode 更新时调用，但是可能发生在其子 VNode 更新之前。 可判断忽略更新</span></span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 指令所在组件的 VNode 及其子 VNode 全部更新后调用。</span></span><br><span class="line">  <span class="title function_">componentUpdated</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 指令与元素解绑</span></span><br><span class="line">  <span class="title function_">unbind</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="sync；"><a href="#sync；" class="headerlink" title=".sync；"></a>.sync；</h3><p>限制：</p>
<ul>
<li>不能和表达式一起使用；</li>
<li>不接受字面量对象；</li>
</ul>
<p>this.$emit(‘update:title’, ‘张三’)</p>
<p><Text-Document
  :title="name"
  :update:title="name = $event"
/></p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>beforeCreated                     init Events &amp; lifecycle<br>created                           init Injections &amp; reactivity<br>beforeMount                       template<br>mounted                           vm.$el   el<br>beforeUpdate<br>update<br>beforeDestory<br>destory</p>
<h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><h3 id="生命周期-1"><a href="#生命周期-1" class="headerlink" title="生命周期"></a>生命周期</h3><blockquote>
<p>16之前</p>
</blockquote>
<p>constructor<br>componentWillReceivePorps（废弃）<br>componentWillMount（废弃）<br>render<br>componentDidMount</p>
<p>componentWillUpdate（废弃）</p>
<blockquote>
<p>16以后</p>
</blockquote>
<p>constructor<br>getDrivedStateFromProps（新增）<br>render<br>componentDidMount</p>
<p>getSnapshotBeforeUpdate（新增）</p>
<h3 id="fiber架构"><a href="#fiber架构" class="headerlink" title="fiber架构"></a>fiber架构</h3><p>react16版本之前，递归渲染vdom，然后diff下来做patch渲染。渲染和diff是递归进行的。</p>
<p>fiber是讲vdom先转成fiber，这个过程就是reconcile。fiber是链表，可用schedule来空闲调度（requestIdleCallback），<br>最后一次性render，这个过程称为commit。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/11/12/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/" data-id="clu6rtt95002oa8xaamaj3x6k" data-title="前端基础面试题整理" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/interview/" rel="tag">interview</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-基于sentry的异常捕获平台" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/11/05/%E5%9F%BA%E4%BA%8Esentry%E7%9A%84%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E5%B9%B3%E5%8F%B0/" class="article-date">
  <time class="dt-published" datetime="2019-11-05T06:53:56.000Z" itemprop="datePublished">2019-11-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/11/05/%E5%9F%BA%E4%BA%8Esentry%E7%9A%84%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E5%B9%B3%E5%8F%B0/">基于sentry的异常捕获平台</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="sentry-介绍"><a href="#sentry-介绍" class="headerlink" title="sentry 介绍"></a>sentry 介绍</h2><p>sentry 是一个开源的实时错误追踪系统，可以帮助开发者实时监控和统计异常信息。比如客户端和 h5 的 crash 的信息，有了 sentry 以后我们就可以第一时间来处理和解决系统的问题，就不需要过度地依赖用户反馈来定位问题了。sentry 主要包括服务端和客户端 SDK,对于系统集成这一块，sentry 提供了主流语言和框架的支持，包括 java、android、ios、javascript 等都提供官方了 SDK,同时 sentry 提供了一些比较流行的服务的集成插件，比如 jira、github、gitlab、pagerduty、dingding 等。</p>
<h2 id="sentry-架构"><a href="#sentry-架构" class="headerlink" title="sentry 架构"></a>sentry 架构</h2><p>sentry 的架构分位客户端和服务端，而且 sentry 官方提供不同语言和框架的集成 SDK。我们选择相应的 SDK 后就可以将错误信息实时上报到 sentry 的服务端。而 sentry 的服务端分为 web、cron、worker 这几个部分，主要工作流程为，应用程序或者客户端发生错误后将错误信息上报给 web 模块，web 模块处理后放入消息队列(rocketmq)或 redis 内存队列，worker 从队列中消费数据进行处理并存储 postgresql 中，如果配置相应报警规则根据配置报警工具进行报警。下图为 sentry 工作示意图：</p>
<img data-role="image" src="https://cdn.nlark.com/yuque/0/2019/png/484053/1571292721535-807923a9-6f5a-4059-bfe5-b00c206dbe5e.png" data-raw-src="https://cdn.nlark.com/yuque/0/2019/png/484053/1571292721535-807923a9-6f5a-4059-bfe5-b00c206dbe5e.png" class="image lake-drag-image" alt="image.png" title="image.png" style="visibility: visible; width: 746px; height: 283px;">

<h2 id="sentry-安装"><a href="#sentry-安装" class="headerlink" title="sentry 安装"></a>sentry 安装</h2><p>Sentry 本身是基于 Django 开发的，而且也依赖到其他的如 Postgresql、 Redis 等组件，所以一般有两种途径进行安装：通过 Docker 或用 Python 搭建。官网下分别有以下的两个介绍：<br>Docker 安装 <a target="_blank" rel="noopener" href="https://docs.sentry.io/server/installation/docker/">https://docs.sentry.io/server/installation/docker/</a><br>Python 安装 <a target="_blank" rel="noopener" href="https://docs.sentry.io/server/installation/python/">https://docs.sentry.io/server/installation/python/</a><br>我们采用的是 docker 安装方式，如果是采用 docker 安装的方式，那么还有一种更加便捷的方式，那么就是采用 docker-compose 了，具体安装步骤如下：</p>
<p>注意，通过 Docker 本地搭建 Sentry 的时候，需要 docker 版本为 1.10.0 以上，docker-compose 版本为 1.17.0 以上，同时要求最低有 3GB 的可用内存。</p>
<ol>
<li>安装 docker、docker-compose</li>
</ol>
<p>这里采用 yum 安装，具体安装步骤如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装一些必要的系统工具</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加软件源信息</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">更新 yum 缓存</span></span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装 Docker-ce</span></span><br><span class="line">yum -y install docker-ce</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动 Docker 后台服务</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载docket-compose</span></span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.17.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改权限</span></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装 sentry</li>
</ol>
<p>其实 sentry 社区了提供一个基于 docker-composed 的开源项目，通过它我们可以一键部署 sentry。首先我克隆该项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/getsentry/onpremise.git</span><br><span class="line">cd onpremise</span><br><span class="line">-rw-r--r-- 1 root root  2017 Oct 15 22:27 config.yml</span><br><span class="line">-rw-r--r-- 1 root root  1427 Oct 16 16:27 docker-compose.yml</span><br><span class="line">-rw-r--r-- 1 root root    43 Oct 15 18:05 Dockerfile</span><br><span class="line">-rwxr-xr-x 1 root root  2766 Oct 15 18:05 install.sh</span><br><span class="line">-rw-r--r-- 1 root root 11356 Oct 15 18:05 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root   548 Oct 15 18:05 Makefile</span><br><span class="line">-rw-r--r-- 1 root root  2167 Oct 15 18:05 README.md</span><br><span class="line">-rw-r--r-- 1 root root    42 Oct 16 17:24 requirements.txt</span><br><span class="line">-rw-r--r-- 1 root root 11493 Oct 15 18:05 sentry.conf.py</span><br><span class="line">-rwxr-xr-x 1 root root  1020 Oct 15 18:05 test.sh</span><br></pre></td></tr></table></figure>

<p>如果并没有特殊要求或者额外的组件配置的话，可以直接运行 .&#x2F;install.sh 将 sentry 及其依赖都通过 docker 安装。由于我们 redis 和 postgresql 是采用阿里云托管的，所以我们不能采用这种方式进行安装。具体步骤如下：</p>
<p>2.1 创建环境变量文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">新建环境变量文件.<span class="built_in">env</span>,根据.env.example拷贝一份即可</span></span><br><span class="line">cp .env.example .env</span><br></pre></td></tr></table></figure>

<p>2.2 修改 docker-compose.xml 文件</p>
<p>删除 redis、postgresql 等镜像依赖，并配置容器的时区，具体配置内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.4&#x27;</span><br><span class="line"></span><br><span class="line">x-defaults: &amp;defaults</span><br><span class="line">  restart: unless-stopped</span><br><span class="line">  build:</span><br><span class="line">    context: .</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> depends_on:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - redis</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - postgres</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - memcached</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   - smtp</span></span><br><span class="line">  env_file: .env</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">时区配置</span></span><br><span class="line">  environment:</span><br><span class="line">    - TZ=Asia/Shanghai</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   SENTRY_MEMCACHED_HOST: memcached</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   SENTRY_REDIS_HOST: redis</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   SENTRY_POSTGRES_HOST: postgres</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   SENTRY_EMAIL_HOST: smtp</span></span><br><span class="line">  volumes:</span><br><span class="line">    - sentry-data:/var/lib/sentry/files</span><br><span class="line">    # 时区配置</span><br><span class="line">    - /etc/localtime:/etc/localtime:ro</span><br><span class="line">    - /etc/timezone:/etc/timezone:ro</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> smtp:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   restart: unless-stopped</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   image: tianon/exim4</span></span><br><span class="line"></span><br><span class="line">&quot;docker-compose.yml&quot; [readonly] 72L, 1432C                                                                                                         1,1           Top</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> memcached:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   restart: unless-stopped</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   image: memcached:1.5-alpine</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> redis:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   restart: unless-stopped</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   image: redis:3.2-alpine</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> postgres:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   restart: unless-stopped</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   image: postgres:9.5</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   volumes:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">     - sentry-postgres:/var/lib/postgresql/data</span></span><br><span class="line"></span><br><span class="line">  web:</span><br><span class="line">    &lt;&lt;: *defaults</span><br><span class="line">    #web端口号，默认为9000</span><br><span class="line">    ports:</span><br><span class="line">      - &#x27;9000:9000&#x27;</span><br><span class="line"></span><br><span class="line">  cron:</span><br><span class="line">    &lt;&lt;: *defaults</span><br><span class="line">    command: run cron</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">work为了保证高可用，起了两个节点</span></span><br><span class="line">  worker1:</span><br><span class="line">    &lt;&lt;: *defaults</span><br><span class="line">    command: run worker</span><br><span class="line"></span><br><span class="line">  worker2:</span><br><span class="line">    &lt;&lt;: *defaults</span><br><span class="line">    command: run worker</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">    sentry-data:</span><br><span class="line">      external: true</span><br><span class="line">    sentry-postgres:</span><br><span class="line">      external: true</span><br></pre></td></tr></table></figure>

<p>2.3 构建 docker-compose 镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build --pull</span><br></pre></td></tr></table></figure>

<p>2.4 生成 sentry 密钥</p>
<p>sentry 是用于 sentry 容器内部免密通信，并把这个值配置到 .env 的 SENTRY_SECRET_KEY key 中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose run --rm web config generate-secret-key</span><br></pre></td></tr></table></figure>

<p>2.5 配置 redis 和 postgresql 连接信息</p>
<p>在.env 文件中添加以下配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">秘钥，由于容器内部免密通信</span></span><br><span class="line">SENTRY_SECRET_KEY=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pg host</span></span><br><span class="line">SENTRY_POSTGRES_HOST=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pg port</span></span><br><span class="line">SENTRY_POSTGRES_PORT=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pg 数据库名称</span></span><br><span class="line">SENTRY_DB_NAME=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pg 用户</span></span><br><span class="line">SENTRY_DB_USER=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pg 用户密码</span></span><br><span class="line">SENTRY_DB_PASSWORD=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis host</span></span><br><span class="line">SENTRY_REDIS_HOST=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis passowrd</span></span><br><span class="line">SENTRY_REDIS_PASSWORD=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis 端口号</span></span><br><span class="line">SENTRY_REDIS_PORT=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis 数据名</span></span><br><span class="line">SENTRY_REDIS_DB=</span><br></pre></td></tr></table></figure>

<p>注意：这里 postgresql 官方建议采用 9.5 和 9.6，由于阿里云没有这两个版本，所以我们采用 10 的版本。目前运行没有发现任何问题。redis 需要 3.2 以上版本，并且 sentry 不支持集群版的 redis。我们采用的 4.0 单机主从版。进行 Web 服务迁移</p>
<p>2.6 进行 Web 服务迁移</p>
<p>主要是初始化表结构和建用户等操作。具体操作执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose run --rm web upgrade</span><br></pre></td></tr></table></figure>

<p>注意：注意在这个过程中命令行会提示你是否创建超级用户，如果确定，则输入邮箱和密码。如果没有创建用户，可以在升级结束后可以手动创建一个用户，具体执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose run --rm web createuser</span><br></pre></td></tr></table></figure>

<p>2.7 运行 sentry</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动容器</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置邮件信息</li>
</ol>
<p>当 sentry 采集到了异常信息就可以通过邮件的方式，发送给指定的处理人。而且这些配置信息是无法在 web console 中修改的，具体操作是在.env 环境变量文件，添加以下配置项：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">邮件的发送地址</span></span><br><span class="line">ENTRY_SERVER_EMAIL=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">smtp服务器主机地址</span></span><br><span class="line">SENTRY_EMAIL_HOST=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">smtp 服务器用户</span></span><br><span class="line">SENTRY_EMAIL_USER=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">smtp服务器密码</span></span><br><span class="line">SENTRY_EMAIL_PASSWORD=</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">smtp服务器端口,注意如果采用qq的企业邮箱，这里不是foxmail中配置的465，而是25（巨坑）。</span></span><br><span class="line">SENTRY_EMAIL_PORT=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">是否使用TLS，默认为<span class="literal">false</span></span></span><br><span class="line">SENTRY_EMAIL_USE_TLS=</span><br></pre></td></tr></table></figure>

<p>重启 sentry 服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose run --rm web upgrade</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>集成钉钉及时通讯工具</li>
</ol>
<p>我们公司使用钉钉作为内部通讯和工作辅助工作，平时工作中大家都可以通过 pc 端和 app 端第一时间查看到消息，并且报警对即时性要求比较高，所以集成钉钉很有必要，下面介绍一下 sentry 集成钉钉的步骤。</p>
<ol>
<li>安装 sentry-dingding 插件，sentry 的强大和可扩展是它很受欢迎的原因。目前开源社区相关 sentry 的插件也是很丰富的,sentry 钉钉插件 github 地址：<a target="_blank" rel="noopener" href="https://github.com/anshengme/sentry-dingding">https://github.com/anshengme/sentry-dingding</a>。<br>sentry 为了方便我们安装插件，提供了一个 requirements.txt 文件。我们只需要将我们现需要安装的插件配置进去，重新构建镜像就可以完成安装和集成。修改 requirements.txt：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加钉钉插件</span></span><br><span class="line">sentry-dingding~=0.0.3</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>重启 sentry 服务</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose run --rm web upgrade</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>集成 LDAP</li>
</ol>
<p>跟集成钉钉一样，sentry 社区也提供了集成插件，sentry ldap 插件地址：<a target="_blank" rel="noopener" href="https://github.com/Banno/getsentry-ldap-auth">https://github.com/Banno/getsentry-ldap-auth</a>。 1.安装 ldap 插件，这里跟安装钉钉插件有一定区别，钉钉是直接配置在 requirements.txt 中就可以了。而 ldap 插件如果采用这样的方式可能会报错，原因是 ldap 插件需要依赖 python-ldap 相关环节，所以我们需要在先安装这些依赖。具体安装步骤如下：</p>
<ol>
<li>安装 sentry ldap 插件<br>修改 DokerFile 文件，在文件添加以下内容：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">切换成国内的源，提高下载速度。但是貌似没啥用，下载还是很慢，后面在看看是什么原因</span></span><br><span class="line">RUN sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list</span><br><span class="line">RUN apt-get clean</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">更新源，这一步很重要不能省略，否则后面会下载失败</span></span><br><span class="line">RUN apt-get update</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装python-ldap相关依赖</span></span><br><span class="line">RUN apt-get install -y libsasl2-dev python-dev libldap2-dev libssl-dev</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装sentry-ldap插件</span></span><br><span class="line">RUN pip install sentry-ldap-auth</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置 ldap 插件<br>在 sentry.conf.py 文件添加以下配置项:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ldap</span><br><span class="line"><span class="keyword">from</span> django_auth_ldap.config <span class="keyword">import</span> LDAPSearch, GroupOfUniqueNamesType</span><br><span class="line"><span class="comment">#设置ldap服务器地址</span></span><br><span class="line">AUTH_LDAP_SERVER_URI = <span class="string">&#x27;ldap://secad.poizon.com:3489&#x27;</span></span><br><span class="line"><span class="comment">#ldap管理员账号</span></span><br><span class="line">AUTH_LDAP_BIND_DN = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"><span class="comment">#ldap管理员密码</span></span><br><span class="line">AUTH_LDAP_BIND_PASSWORD = <span class="string">&#x27;xxxxx&#x27;</span></span><br><span class="line"><span class="comment">#ldap搜索路径，这里配置成技术部，需要注意如果有中文需要转成unicode的格式</span></span><br><span class="line">OU=unicode(<span class="string">&#x27;OU=技术部,OU=识装,DC=sz,DC=du&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">AUTH_LDAP_USER_SEARCH = LDAPSearch(</span><br><span class="line">    OU,</span><br><span class="line">    ldap.SCOPE_SUBTREE,</span><br><span class="line">    <span class="string">&#x27;(mail=%(user)s)&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">AUTH_LDAP_GROUP_SEARCH = LDAPSearch(</span><br><span class="line">    <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    ldap.SCOPE_SUBTREE,</span><br><span class="line">    <span class="string">&#x27;(objectClass=groupOfUniqueNames)&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">AUTH_LDAP_GROUP_TYPE = GroupOfUniqueNamesType()</span><br><span class="line">AUTH_LDAP_REQUIRE_GROUP = <span class="literal">None</span></span><br><span class="line">AUTH_LDAP_DENY_GROUP = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">AUTH_LDAP_USER_ATTR_MAP = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;cn&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;mail&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AUTH_LDAP_FIND_GROUP_PERMS = <span class="literal">False</span></span><br><span class="line">AUTH_LDAP_CACHE_GROUPS = <span class="literal">True</span></span><br><span class="line">AUTH_LDAP_GROUP_CACHE_TIMEOUT = <span class="number">3600</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果ldap认证成功，默认给用户加入poizon组织中</span></span><br><span class="line">AUTH_LDAP_DEFAULT_SENTRY_ORGANIZATION = <span class="string">u&#x27;poizon&#x27;</span></span><br><span class="line"><span class="comment">#默认的用户的角色是member</span></span><br><span class="line">AUTH_LDAP_SENTRY_ORGANIZATION_ROLE_TYPE = <span class="string">&#x27;member&#x27;</span></span><br><span class="line"><span class="comment">#开通相应的操作权限</span></span><br><span class="line">AUTH_LDAP_SENTRY_ORGANIZATION_GLOBAL_ACCESS = <span class="literal">True</span></span><br><span class="line"><span class="comment">#指定sentry的username字段名称</span></span><br><span class="line">AUTH_LDAP_SENTRY_USERNAME_FIELD = <span class="string">&#x27;uid&#x27;</span></span><br><span class="line"><span class="comment">#指定sentry的角色和ldap的角色的绑定关系，这里我们暂时不设置</span></span><br><span class="line">AUTH_LDAP_SENTRY_GROUP_ROLE_MAPPING = &#123;&#125;</span><br><span class="line"><span class="comment">#扩展登录方式，采用Ldap的方式进行认证</span></span><br><span class="line">AUTHENTICATION_BACKENDS = AUTHENTICATION_BACKENDS + (</span><br><span class="line">    <span class="string">&#x27;sentry_ldap_auth.backend.SentryLdapBackend&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#LOG配置</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;django_auth_ldap&#x27;</span>)</span><br><span class="line">logger.addHandler(logging.StreamHandler())</span><br><span class="line">logger.setLevel(<span class="string">&#x27;DEBUG&#x27;</span>)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/11/05/%E5%9F%BA%E4%BA%8Esentry%E7%9A%84%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E5%B9%B3%E5%8F%B0/" data-id="clu6rtt9a0034a8xa16aichg3" data-title="基于sentry的异常捕获平台" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/sentry/" rel="tag">sentry</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-vue项目接入sentry" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/10/11/vue%E9%A1%B9%E7%9B%AE%E6%8E%A5%E5%85%A5sentry/" class="article-date">
  <time class="dt-published" datetime="2019-10-11T07:51:00.000Z" itemprop="datePublished">2019-10-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/10/11/vue%E9%A1%B9%E7%9B%AE%E6%8E%A5%E5%85%A5sentry/">vue项目接入sentry</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先需要下载官方提供的 sdk，在项目入口处加入进去。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add @sentry/browser</span><br><span class="line">yarn add @sentry/integrations</span><br></pre></td></tr></table></figure>

<p>在应用的入口文件，比如 app.js，加入如下配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Sentry</span> <span class="keyword">from</span> <span class="string">&#x27;@sentry/browser&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Integrations</span> <span class="keyword">from</span> <span class="string">&#x27;@sentry/integrations&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Sentry</span>.<span class="title function_">init</span>(&#123;</span><br><span class="line"> <span class="attr">dsn</span>: <span class="string">&#x27;https://xxxx@sentry.io/1772852&#x27;</span>,</span><br><span class="line"> <span class="attr">integrations</span>: [<span class="keyword">new</span> <span class="title class_">Integrations</span>.<span class="title class_">Vue</span>(&#123; <span class="title class_">Vue</span>, <span class="attr">attachProps</span>: <span class="literal">true</span> &#125;)]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>其中 dsn 是在 sentry 创建的项目的设置中，找到 dsn 的选项 tab，找到项目的默认 dsn</p>
<p>当然如果 application 打包的时候，觉得入口文件体积很大，或者是出于打包速度优化的考虑，可以将 sentry 相关插件通过 cdn 方式引用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;script src=&quot;https://browser.sentry-cdn.com/5.7.1/bundle.es6.min.js&quot; integrity=&quot;sha384-h+FyW7fMq0eyUQeRnmnwiWXMxycy0z8n5sOtIH3NJx5GfqxdletL62letiWALtKy&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag"> <span class="attr">src</span>=<span class="string">&quot;https://browser.sentry-cdn.com/5.7.1/bundle.min.js&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">integrity</span>=<span class="string">&quot;sha384-KMv6bBTABABhv0NI+rVWly6PIRvdippFEgjpKyxUcpEmDWZTkDOiueL5xW+cztZZ&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- If you include the integration it will be available under Sentry.Integrations.Vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag"> <span class="attr">src</span>=<span class="string">&quot;https://browser.sentry-cdn.com/5.7.1/vue.min.js&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>做完第一步骤之后，此时项目已经具备有异常错误向 sentry 上报日志的功能，如果我们有更精确知道某些异常错误是哪个发布版本带上的，导致相关异常的开发者是谁，还有想要统计某个版本相对于之前的发布版本，错误情况如何等需求，此时需要使用 sentry 提供的 release 功能。</p>
<p>默认接入 release 官方有几种方式，由于我们发布版本并没有走 gitlab、github 等的 ci 流程，我们采用<code>sentry-cli</code>提供的全局命令编写脚本去集成到项目发布流程中。</p>
<p>简单的 release 脚本如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">export SENTRY_AUTH_TOKEN=9b4f6bf1c75e478cab30bb714e0f8e83d712c02a920640e7b7fbf4dc307c1b33</span><br><span class="line">export SENTRY_ORG=poizon</span><br><span class="line"></span><br><span class="line">PROJECT=&quot;ticket-platform&quot;</span><br><span class="line"></span><br><span class="line">VERSION=`sentry-cli releases propose-version`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Create a release</span></span><br><span class="line">sentry-cli releases -p PROJECT new $VERSION</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">upload sourcemap</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">upload-sourcemaps 指定打包后的js文件在项目的路径</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--url-prefix 外部通过url访问到js静态资源的路径</span></span><br><span class="line">sentry-cli releases -p $PROJECT files $VERSION upload-sourcemaps ./dist/js/ --url-prefix ~/js/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时需要在初始化 sentry 的入口出加上版本号（commitid），和后台看到的版本名称要一致，比如当前 git 的 commitid 前 6 为是 123456，需要改成如下设置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Sentry</span>.<span class="title function_">init</span>(&#123;</span><br><span class="line"> <span class="attr">release</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line"> <span class="attr">dsn</span>: <span class="string">&#x27;https://xxxx@sentry.io/1772852&#x27;</span>,</span><br><span class="line"> <span class="attr">integrations</span>: [<span class="keyword">new</span> <span class="title class_">Integrations</span>.<span class="title class_">Vue</span>(&#123; <span class="title class_">Vue</span>, <span class="attr">attachProps</span>: <span class="literal">true</span> &#125;)]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这时候我们在 sentry 后台系统下查看当前项目的的 release 的 tab 下，能看到已经将 sourcemap 文件都上传到 sentry 服务器。默认<code>sentry-cli</code>提供的 release 版本号是根据最后一次 git 提交的 commitid，这样会导致我们在查看版本的时候，面对一连串的 commitid，并不能很简单明了的看到当前版本号，所以需要我们手动指定版本号。</p>
<ol>
<li>通过手动指定版本号</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">export SENTRY_AUTH_TOKEN=9b4f6bf1c75e478cab30bb714e0f8e83d712c02a920640e7b7fbf4dc307c1b33</span><br><span class="line">export SENTRY_ORG=poizon</span><br><span class="line"></span><br><span class="line">TAG=&quot;ticket-platform@2.10.1&quot;</span><br><span class="line"></span><br><span class="line">PROJECT=&quot;ticket-platform&quot;</span><br><span class="line"></span><br><span class="line">sentry-cli releases -p $PROJECT new $TAG</span><br><span class="line"></span><br><span class="line">sentry-cli releases -p $PROJECT files $TAG upload-sourcemaps ./dist/js/ --url-prefix ~/js/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>初始化的入口处传入的 release 也设置为<code>ticket-platform@2.10.1</code>，可以看到这样的方式很繁琐。</p>
<ol start="2">
<li>通过官方提供的 webpack 插件<code>@sentry/webpack-plugin</code></li>
</ol>
<p>前提：项目下新建一个<code>.sentryclirc</code>文件，写好 sentry 配置项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[defaults]</span><br><span class="line">url=https://xxx.xxxx.com</span><br><span class="line">org=xxx</span><br><span class="line">project=ticket-platform</span><br><span class="line"></span><br><span class="line">[auth]</span><br><span class="line">token=9b4f6bf1c75e478cab30bb714e0f8e83d712c02a920640e7b7fbf4dc307c1b33</span><br></pre></td></tr></table></figure>

<p>修改项目本身的 webpack 配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">SentryCliPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;@sentry/webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">SentryCliPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">include</span>: <span class="string">&#x27;./dist/js&#x27;</span>,</span><br><span class="line">      <span class="attr">ignore</span>: [<span class="string">&#x27;node_modules&#x27;</span>]</span><br><span class="line">      <span class="attr">urlPrefix</span>: <span class="string">&#x27;~/js/&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>可以看到默认提供的插件也是按照 commitid，在我们项目中在构建的过程时流程大概如下：</p>
<ul>
<li>标准的 git coommit（commitizen&#x2F;cz-cli）</li>
<li>发版前 standard-version 生成本次的版本号</li>
<li>打包时 获取<code>package.json</code>的 version 传入<code>SentryCliPlugin</code>的配置项<code>release</code></li>
</ul>
<p>至此 vue 项目完美接入 sentry</p>
<p>参考资料：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://docs.sentry.io/platforms/javascript/vue/">sentry 文档接入 vue</a></li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@sentry/webpack-plugin">@sentry&#x2F;webpack-plugin</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000014683598#articleHeader5">Sentry 前端部署拓展篇（sourcemap 关联、issue 关联、release 控制）</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5bfe0d5be51d4562587b40b9">前端日志监控平台 sentry 使用 @sentry&#x2F;browser @sentry&#x2F;webpack-plugin</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/10/11/vue%E9%A1%B9%E7%9B%AE%E6%8E%A5%E5%85%A5sentry/" data-id="clu6rtt900027a8xad6k2a6ih" data-title="vue项目接入sentry" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/sentry/" rel="tag">sentry</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-js继承问题总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/09/24/js%E7%BB%A7%E6%89%BF%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2019-09-24T04:24:41.000Z" itemprop="datePublished">2019-09-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/09/24/js%E7%BB%A7%E6%89%BF%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/">js继承问题总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>如果要用 js 实现一个类的话，我们会用构造函数来模拟一个类，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">height</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;的高度未知&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eat</span> = <span class="keyword">function</span>(<span class="params">food</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;正在吃&quot;</span> + food);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>那现在我们需要继承这个<code>Animal</code>的类来实现一个具体的<code>Dog</code>类，我们一般会使用<code>组合继承</code>，方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Dog</span>;</span><br></pre></td></tr></table></figure>

<p>目测是比较完美的继承方式了，但是仔细思考会发现有个问题：</p>
<ol>
<li>在<code>Dog.prototype = new Animal()</code>执行了一次<code>Animal</code>实例；</li>
<li>在 Dog 类实例化时候，内部使用 call 方法的时候又执行了一次<code>Animal</code>实例化；</li>
</ol>
<p>所以这并不是最完美的继承方式。那么我们应该使用什么样的办法才能解决上述问题呢？这个时候就需要用到<code>寄生继承</code>方式，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Dog</span>;</span><br></pre></td></tr></table></figure>

<p>利用一个中间对象先继承父类，减少了第一次继承父类原型的时候会实例化父类的缺点，这应该是目前最完美的继承方法。</p>
<p>参考资料：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8a83ed26ecbb">JS 组合继承（寄生继承）</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/5d53d06ea918">Javascript 完美继承方式 - 寄生组合</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5e6dec09f265da572c54a6e4">理清原型对象、 实例对象、构造函数</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/09/24/js%E7%BB%A7%E6%89%BF%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" data-id="clu6rtt8r0014a8xa2cxufzxa" data-title="js继承问题总结" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-正则表达式必知必会" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/08/30/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" class="article-date">
  <time class="dt-published" datetime="2019-08-30T06:11:43.000Z" itemprop="datePublished">2019-08-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/08/30/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/">正则表达式必知必会</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="规则说明"><a href="#规则说明" class="headerlink" title="规则说明"></a>规则说明</h2><ul>
<li>\n 回车</li>
<li>\t 制表符</li>
<li>\r 换行符</li>
<li>\s 空格</li>
<li>\u4e00-\u9fa5 中文</li>
<li>\w 大小写字母_数字</li>
<li>\b : 独立的部分 （ 起始，结束，空格 ）</li>
<li>{n, m} 至少出现 n 次 最多 m 次</li>
<li>{n,} 至少 n 次</li>
<li>. 任意次</li>
<li>+ 至少一次</li>
<li>{n} 至少 n 次</li>
<li>() 子表达式，分组符号</li>
<li>[\s\S] 任意字符</li>
<li>^ 放在正则的最开始位置，就代表起始的意思，注意 &#x2F;[^a] &#x2F; 和 &#x2F;^[a]&#x2F;是不一样的，前者是排除的意思，后者是代表首位。</li>
<li>[] 表示某个集合中的任意一个</li>
<li>[^a] 排除 a</li>
<li>?&#x3D;   向前查找</li>
<li>?&lt;&#x3D;  向后查找</li>
<li>?!   负向前查找</li>
<li>?&lt;!  负向后查找（不包含）</li>
</ul>
<h2 id="常用匹配规则"><a href="#常用匹配规则" class="headerlink" title="常用匹配规则"></a>常用匹配规则</h2><ul>
<li>匹配中文: [\u4e00-\u9fa5]</li>
<li>任意字符：.*（贪婪型） .*?（懒惰型）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//去掉a标签</span></span><br><span class="line">a =</span><br><span class="line"> <span class="string">&#x27;度假：原价购页面&lt;a href=&quot;jumpType:22,jumplink:273&quot; style=&quot;font-size:16px&quot;&gt;sss&lt;/a&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  .*? 是一个组合 尽可能匹配少的内容 即不会贪婪匹配到&lt;/a&gt;结束</span></span><br><span class="line">a.<span class="title function_">replace</span>(<span class="regexp">/&lt;\/?a.*?&gt;/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;2013-6-7&#x27;</span>;</span><br><span class="line"><span class="comment">// 全局匹配数字，横杠，横杠数量至少为1，匹配结果为：  3- 6-</span></span><br><span class="line"><span class="keyword">var</span> re1 = <span class="regexp">/\d-+/g</span>;</span><br><span class="line"><span class="comment">// 全局匹配数字，横杠，数字和横杠整体数量至少为1   3-6-</span></span><br><span class="line"><span class="keyword">var</span> re1 = <span class="regexp">/(\d-)+/g</span>;</span><br><span class="line"><span class="comment">// 全局匹配至少一个数字，匹配一个横杠 匹配结果：2013- 6-</span></span><br><span class="line"><span class="keyword">var</span> re2  = <span class="regexp">/(\d+)(-)/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;2013-6-7&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/(\d+)(-)/g</span>;</span><br><span class="line"></span><br><span class="line">str = str.<span class="title function_">replace</span>(re,<span class="keyword">function</span>(<span class="params">$0,$1,$2</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//replace()中如果有子项，</span></span><br><span class="line">    <span class="comment">//第一个参数：$0（匹配成功后的整体结果  2013-  6-）,</span></span><br><span class="line">    <span class="comment">// 第二个参数 : $1(匹配成功的第一个分组，这里指的是\d   2013, 6)</span></span><br><span class="line">    <span class="comment">//第三个参数 : $1(匹配成功的第二个分组，这里指的是-    - - )</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $1 + <span class="string">&#x27;.&#x27;</span>;  <span class="comment">//分别返回2013.   6.</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// var re = /\bclassname\b/;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能这样写，当正则需要用到参数时候，一定要用全称的写法，简写方式会</span></span><br><span class="line"><span class="comment">// 把classname当做一个字符串去匹配。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> re = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;\\b&#x27;</span>+classname+<span class="string">&#x27;\\b&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配的时候，classname前面必须是起始或者空格，后面也是。</span></span><br><span class="line"></span><br><span class="line">默认匹配成功就停止，所以就算有重复的也不会再匹配进去了。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="回溯引用：前后一致匹配"><a href="#回溯引用：前后一致匹配" class="headerlink" title="回溯引用：前后一致匹配"></a>回溯引用：前后一致匹配</h2><p>背景</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试文本</span></span><br><span class="line"><span class="keyword">var</span> str1 = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;Body&gt;</span></span><br><span class="line"><span class="string">    &lt;H1&gt;Welcome to my Homepage&lt;/H1&gt;</span></span><br><span class="line"><span class="string">    Content is divided into two sections: &lt;BR&gt;</span></span><br><span class="line"><span class="string">    &lt;H2&gt;ColdFusion&lt;/H2&gt;</span></span><br><span class="line"><span class="string">    Information about Macromedia ColdFusion.</span></span><br><span class="line"><span class="string">    &lt;H2&gt;Wireless&lt;/H2&gt;</span></span><br><span class="line"><span class="string">    Information about Bluetooth, 802.11, and more.</span></span><br><span class="line"><span class="string">&lt;/Body&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意 .*? （懒惰型） 而不是.*（贪婪型），</span></span><br><span class="line"><span class="comment">// 如果是.*有可能会存在从H1一直匹配到H6的情况出现</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="regexp">/&lt;[Hh][1-6]&gt;.*?&lt;\/[Hh][1-6]&gt;/g</span></span><br></pre></td></tr></table></figure>

<p>缺点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试文本</span></span><br><span class="line"><span class="keyword">var</span> str1 = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;Body&gt;</span></span><br><span class="line"><span class="string">    &lt;H1&gt;Welcome to my Homepage&lt;/H1&gt;</span></span><br><span class="line"><span class="string">    Content is divided into two sections: &lt;BR&gt;</span></span><br><span class="line"><span class="string">    &lt;H2&gt;ColdFusion&lt;/H2&gt;</span></span><br><span class="line"><span class="string">    Information about Macromedia ColdFusion.</span></span><br><span class="line"><span class="string">    &lt;H2&gt;Wireless&lt;/H3&gt;</span></span><br><span class="line"><span class="string">    Information about Bluetooth, 802.11, and more.</span></span><br><span class="line"><span class="string">&lt;/Body&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意 .*? （懒惰型） 而不是.*（贪婪型），</span></span><br><span class="line"><span class="comment">// 如果是.*有可能会存在从H1一直匹配到H6的情况出现</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="regexp">/&lt;[Hh][1-6]&gt;.*?&lt;\/[Hh][1-6]&gt;/g</span></span><br></pre></td></tr></table></figure>

<p>此时使用上述匹配会匹配到不合法的字符（&lt;H2&gt;Wireless&lt;&#x2F;H3&gt;），在这种情况下只能求助于回溯引用。</p>
<h3 id="回溯引用"><a href="#回溯引用" class="headerlink" title="回溯引用"></a>回溯引用</h3><p>指得是模式的后半部分引用在前半部分中定义的<em>子表达式</em>。</p>
<p>回溯引用匹配通常从1开始计数（\1、\2等）。在许多实现里，第0个匹配（\0）可以用来代表整个正则表达式</p>
<p>与字符串的replace方法的回调使用$0, $1, $2等参数类似</p>
<p>其他一些元字符</p>
<table>
<thead>
<tr>
<th>元字符</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td>\E</td>
<td align="center">结束\L或\U转换</td>
</tr>
<tr>
<td>\l</td>
<td align="center">把下一个字符转换为小写</td>
</tr>
<tr>
<td>\L</td>
<td align="center">把\L到\E之间的字符全部转换为小写</td>
</tr>
<tr>
<td>\u</td>
<td align="center">把下一个字符转换为大写</td>
</tr>
<tr>
<td>\U</td>
<td align="center">把\U到\E之间的字符全部转换为大写</td>
</tr>
</tbody></table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> b = <span class="string">&#x27;313-555-123&#x27;</span>.<span class="title function_">replace</span>(<span class="regexp">/(\d&#123;3&#125;)(-)(\d&#123;3&#125;)-(\d&#123;3&#125;)/g</span>, <span class="function">(<span class="params">$0, $1, $2, $3, $4</span>) =&gt;</span> <span class="string">`(<span class="subst">$&#123;$1&#125;</span>) <span class="subst">$&#123;$3&#125;</span>-<span class="subst">$&#123;$4&#125;</span>`</span>) <span class="comment">// (313) 555-123</span></span><br></pre></td></tr></table></figure>

<p>解决</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试文本</span></span><br><span class="line"><span class="keyword">var</span> str1 = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;Body&gt;</span></span><br><span class="line"><span class="string">    &lt;H1&gt;Welcome to my Homepage&lt;/H1&gt;</span></span><br><span class="line"><span class="string">    Content is divided into two sections: &lt;BR&gt;</span></span><br><span class="line"><span class="string">    &lt;H2&gt;ColdFusion&lt;/H2&gt;</span></span><br><span class="line"><span class="string">    Information about Macromedia ColdFusion.</span></span><br><span class="line"><span class="string">    &lt;H2&gt;Wireless&lt;/H3&gt;</span></span><br><span class="line"><span class="string">    Information about Bluetooth, 802.11, and more.</span></span><br><span class="line"><span class="string">    &lt;H2&gt;Wireless&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&lt;/Body&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="regexp">/&lt;([Hh][1-6])&gt;.*?&lt;\/\1&gt;/g</span></span><br></pre></td></tr></table></figure>

<h2 id="前后查找"><a href="#前后查找" class="headerlink" title="前后查找"></a>前后查找</h2><h3 id="概括"><a href="#概括" class="headerlink" title="概括"></a>概括</h3><p>从结果中排除最终不需要的辅助查找的字符</p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>比如有一些字符串&lt;h1&gt;ssss&lt;&#x2F;h1&gt;，我们只需要其中的ssss，不需要在返回的结果中包含&lt;h1&gt;等标签字符，一般做法是先想办法把他们检索出来，在以手动形式排除，这既浪费时间，又容易招致不必要的后患。这时候就需要一种模式，包含匹配的本身并不返回，而是用于确定正确的匹配位置，他并不是匹配结果的一部分。换句话说，我们需要进行<strong>前后查找</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试文本</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">`</span></span><br><span class="line"><span class="string">http://www.forta.com/</span></span><br><span class="line"><span class="string">https://www.forta.com/</span></span><br><span class="line"><span class="string">ftp://www.forta.com/</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 向前查找   匹配字符直到:停止（不包含:）</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="regexp">/.+(?=:)/g</span>   <span class="comment">// http https ftp</span></span><br><span class="line"><span class="comment">// 包含:</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="regexp">/.+(:)/g</span>     <span class="comment">// http: https: ftp:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取物品价格</span></span><br><span class="line"><span class="keyword">var</span> str1 = <span class="string">`</span></span><br><span class="line"><span class="string">ABCD: $23.25</span></span><br><span class="line"><span class="string">HFG1: $5.3</span></span><br><span class="line"><span class="string">XTC99: $69.1</span></span><br><span class="line"><span class="string">Total items found: 4</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果会有多余的$</span></span><br><span class="line"><span class="keyword">var</span> a1 = <span class="regexp">/\$\d+\.\d+/g</span> <span class="comment">// $23.25 $5.3 $69.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 向后查找 结果不会返回多余的$  </span></span><br><span class="line"><span class="keyword">var</span> b1 = <span class="regexp">/(?&lt;=\$)\.\d+/g</span> <span class="comment">// 23.25 5.3 69.1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取购买物品的数量</span></span><br><span class="line"><span class="keyword">var</span> str2 = <span class="string">`</span></span><br><span class="line"><span class="string">I paid $30 for 100 apples, 50 oranges, and 60 pears. I saved $5 on this order.</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a2 = <span class="string">`/\b(?&lt;!\$)\d+/g`</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/08/30/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" data-id="clu6rtt9g003ra8xab55d6oqs" data-title="正则表达式必知必会" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-pm2常用命令整理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/07/25/pm2%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2019-07-25T14:34:15.000Z" itemprop="datePublished">2019-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/07/25/pm2%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/">pm2常用命令整理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li>pm2 start</li>
</ul>
<p>之前一直使用过程中，都是指定一个启动文件（<code>pm2 start app.js</code>），后来在用<code>pm2</code>部署<code>nuxt.js</code>项目时候，发现这样的方式不太能用，查阅文档发现可以使用以 npm 方式执行 script 脚本命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pm2 start npm --name <span class="string">&#x27;进程名称&#x27;</span> -- run 脚本命令</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">package.json</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> script: &#123;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   <span class="string">&quot;start:nuxt&quot;</span>: <span class="string">&quot;nuxt build&quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">&#125;</span></span><br><span class="line">pm2 start npm -- run start:nuxt --name &#x27;nuxt&#x27;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/07/25/pm2%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/" data-id="clu6rtt8u001la8xa1qgi27of" data-title="pm2常用命令整理" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/node/" rel="tag">node</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-centos下利用nvm安装node" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/07/24/centos%E4%B8%8B%E5%88%A9%E7%94%A8nvm%E5%AE%89%E8%A3%85node/" class="article-date">
  <time class="dt-published" datetime="2019-07-24T06:43:38.000Z" itemprop="datePublished">2019-07-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/07/24/centos%E4%B8%8B%E5%88%A9%E7%94%A8nvm%E5%AE%89%E8%A3%85node/">centos下利用nvm安装node</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li>安装 github</li>
</ul>
<p>yum install git -y</p>
<ul>
<li>下载 nvm</li>
</ul>
<p>git clone git:&#x2F;&#x2F;github.com&#x2F;creationix&#x2F;nvm.git ~&#x2F;nvm</p>
<ul>
<li>设置 nvm 自动运行;</li>
</ul>
<p>echo “source ~&#x2F;nvm&#x2F;nvm.sh” &gt;&gt; ~&#x2F;.bashrc<br>source ~&#x2F;.bashrc</p>
<ul>
<li>查询 node 版本</li>
</ul>
<p>nvm list-remote</p>
<ul>
<li>安装 node.js</li>
</ul>
<p>nvm install v10.15.1</p>
<ul>
<li>使用 nodejs<br>nvm use v10.15.1</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/07/24/centos%E4%B8%8B%E5%88%A9%E7%94%A8nvm%E5%AE%89%E8%A3%85node/" data-id="clu6rtt8f000ja8xa9awahe3o" data-title="centos下利用nvm安装node" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-一些新的api" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/07/22/%E4%B8%80%E4%BA%9B%E6%96%B0%E7%9A%84api/" class="article-date">
  <time class="dt-published" datetime="2019-07-22T15:00:47.000Z" itemprop="datePublished">2019-07-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/07/22/%E4%B8%80%E4%BA%9B%E6%96%B0%E7%9A%84api/">一些新的api</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ol>
<li>IntersectionObserver</li>
</ol>
<p>懒加载实现的一种 api，兼容性</p>
<p>参考资料： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/84a86e41eb2b">谈谈 IntersectionObserver 懒加载</a><br>2. css 一个属性<code>object-fit</code>实现图片的拉伸、裁剪等<br>3. css 动画结束有个事件可以被 js 监听处理</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/07/22/%E4%B8%80%E4%BA%9B%E6%96%B0%E7%9A%84api/" data-id="clu6rtt93002aa8xa08hletmb" data-title="一些新的api" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-记录typescript使用的几个注意点" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/07/22/%E8%AE%B0%E5%BD%95typescript%E4%BD%BF%E7%94%A8%E7%9A%84%E5%87%A0%E4%B8%AA%E6%B3%A8%E6%84%8F%E7%82%B9/" class="article-date">
  <time class="dt-published" datetime="2019-07-22T05:38:34.000Z" itemprop="datePublished">2019-07-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/07/22/%E8%AE%B0%E5%BD%95typescript%E4%BD%BF%E7%94%A8%E7%9A%84%E5%87%A0%E4%B8%AA%E6%B3%A8%E6%84%8F%E7%82%B9/">记录typescript使用的几个注意点</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>近期在做前端团队公共模块和方法的私有 npm 包的时候，采用<code>typescript</code>保证包的代码质量，在使用<code>ts</code>的过程遇到一些小问题，特此记录下遇到的一些小问题。</p>
<ol>
<li>不想一个个导入类型文件，希望有全局引用类型文件</li>
</ol>
<p>一开始在给每个文件定义类型的时候，都会将文件类型放在<code>types</code>文件夹下，通过<code>es6</code>模块暴露出来并在项目中引入对应的类型文件，开始引用方式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// types/test.d.ts</span></span><br><span class="line"><span class="keyword">export</span> declare <span class="keyword">const</span> test = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/test.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; test &#125; <span class="keyword">from</span> <span class="string">&#x27;../types/test&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样的话默认也是把<code>.d.ts</code>文件当做一个模块，但是每次都引入的时候会比较麻烦，有没有更简便的方法，不需要引入类型文件？</p>
<p>答案是有的：利用全局的<code>namespace</code>和<code>tsconfig.json</code>配置</p>
<p>以下是<code>tsconfig.json</code>一些配置项：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">      <span class="string">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">      <span class="string">&quot;outDir&quot;</span>: <span class="string">&quot;./dist/lib&quot;</span>,</span><br><span class="line">      <span class="string">&quot;declaration&quot;</span>: <span class="literal">true</span>,  <span class="comment">// 开启打包之后会输出.d.ts文件</span></span><br><span class="line">      <span class="string">&quot;declarationDir&quot;</span>: <span class="string">&quot;./dist/types&quot;</span>,  <span class="comment">// 默认.d.ts会输出到文件所在目录下，也可以指定.d.ts存放路径</span></span><br><span class="line">      <span class="string">&quot;strict&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;jsx&quot;</span>: <span class="string">&quot;preserve&quot;</span>,</span><br><span class="line">      <span class="string">&quot;importHelpers&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;removeComments&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">      <span class="string">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;allowJs&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;sourceMap&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;.&quot;</span>,</span><br><span class="line">      <span class="string">&quot;types&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;node&quot;</span>,</span><br><span class="line">        <span class="string">&quot;./types&quot;</span>  <span class="comment">// 本地types所在目录，必须在此引入</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;lib&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;esnext&quot;</span>,</span><br><span class="line">        <span class="string">&quot;dom&quot;</span>,</span><br><span class="line">        <span class="string">&quot;dom.iterable&quot;</span>,</span><br><span class="line">        <span class="string">&quot;scripthost&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;include&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;src/**/*.ts&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/**/**/*.ts&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;exclude&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;node_modules&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意上面的 types 配置需要将自己定义的<code>types</code>文件导入进来，这样一个未知类型会在这个指定范围去查找。</p>
<p>项目代码使用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//types/test.d.ts</span></span><br><span class="line">declare namespace <span class="title class_">Test</span> &#123;</span><br><span class="line">    interface <span class="title class_">Detail</span> &#123;</span><br><span class="line">        <span class="attr">name</span>: string</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/test.ts</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTestDetail</span> (<span class="attr">detail</span>: <span class="title class_">Test</span>.<span class="property">Detail</span>)&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样就不需要项目代码去引用类型文件，缺点是暴露全局的<code>namespace</code>，需要自己根据情况作出取舍。</p>
<ol start="2">
<li>定义自定义对象的属性枚举值</li>
</ol>
<p>定义一个配置对象，除了<code>key</code>之外其他属性一样，利用枚举特性定义<code>key</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">declare enum <span class="variable constant_">ENV</span> &#123;</span><br><span class="line">  dev = <span class="string">&#x27;dev&#x27;</span>,</span><br><span class="line">  prod = <span class="string">&#x27;prod&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">ConfigResult</span> &#123;</span><br><span class="line">  <span class="attr">region</span>: string</span><br><span class="line">  <span class="attr">accessKeyId</span>: string</span><br><span class="line">  <span class="attr">accessKeySecret</span>: string</span><br><span class="line">  <span class="attr">expAfter</span>: number</span><br><span class="line">  <span class="attr">bucket</span>: string</span><br><span class="line">  <span class="attr">maxSize</span>: number</span><br><span class="line">  <span class="attr">startsWith</span>: string</span><br><span class="line">  <span class="attr">ossHost</span>: string</span><br><span class="line">  <span class="attr">host</span>: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">Config</span> &#123;</span><br><span class="line">  [<span class="attr">key</span>: string]: &#123;</span><br><span class="line">    [key <span class="keyword">in</span> <span class="variable constant_">ENV</span>]: <span class="title class_">ConfigResult</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>类型文件里面不能导出&#x2F;定义<code>枚举值</code>，枚举值需要单独定义在代码层面，不然会报</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: Debug Failure. False expression: Output generation failed</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>开发第三方库的时候遇到，开发完之后库打包之后，在项目中导入相关方法并没有相关方法的提示，别人是怎么定义包内部方法的提示呢？在 github 上查阅了几个库，在<code>https://github.com/alibaba/pont</code>这个项目下发现别人<code>typing</code>指向的路径指向本身项目暴露出来的 ts 入口文件，这样就达到使用 ts 的时候有对应的方法提示。</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lib/index.js&quot;</span><span class="punctuation">,</span>   <span class="comment">// 这个是编译后的库入口文件，一般是js</span></span><br><span class="line"><span class="attr">&quot;typings&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/index.ts&quot;</span><span class="punctuation">,</span> <span class="comment">// 这个是给ts用的本身项目开发的出口文件</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>使用<code>paths</code>做路径映射时候，一定要当前项目配置文件指定<code>baseUrl</code>为当前目录，遇到继承外部项目公共基础配置，公共基础配置设置<code>baseUrl</code>之后，<code>paths</code>路径映射是以外部项目为基准；</p>
</li>
<li><p><code>paths</code>做了映射之后，利用提供的<code>tsc</code>编译后的代码并没有做响应的路径转换，比如<code>$src/index.ts</code>，最后编译出来的代码依然是原样，后来是采用<code>rollup.js</code>做了打包处理这个问题。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/07/22/%E8%AE%B0%E5%BD%95typescript%E4%BD%BF%E7%94%A8%E7%9A%84%E5%87%A0%E4%B8%AA%E6%B3%A8%E6%84%8F%E7%82%B9/" data-id="clu6rtt9j0045a8xa13uf1lsd" data-title="记录typescript使用的几个注意点" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/typescript/" rel="tag">typescript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-js中几种设计模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/MyBlog/2019/07/14/js%E4%B8%AD%E5%87%A0%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2019-07-14T13:50:10.000Z" itemprop="datePublished">2019-07-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/MyBlog/2019/07/14/js%E4%B8%AD%E5%87%A0%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">js中几种设计模式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><blockquote>
<p>由工厂对象决定创建某一个对象类的实例</p>
</blockquote>
<p>特点：</p>
<p>不关心创建过程，仅仅关心最终创建结果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 案例1</span></span><br><span class="line"><span class="keyword">var</span> factory = funciton (name) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(name) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;nba&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">NBA</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;cba&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">CBA</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 案例2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Creator</span> &#123;</span><br><span class="line">  <span class="title function_">create</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Product</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> creatorInstance = <span class="keyword">new</span> <span class="title class_">Creator</span>();</span><br><span class="line"></span><br><span class="line">creatorInstance.<span class="title function_">create</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>应用场景：</p>
<ul>
<li>针对同一类别对象，不同表现。比如登录成功之后针对不同用户提示不同话术</li>
<li>React.createElement 也是工厂模式实现</li>
<li>jquery的$选择器</li>
</ul>
<h2 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h2><blockquote>
<p>高级版本的工厂模式</p>
</blockquote>
<p>特点：</p>
<p>不仅关心结果，也关心创建过程</p>
<p>增加了结构的复杂性，如果对象粒度很小或者模块间很少复用或变动不大，最好创建完整对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">Human</span> = (<span class="params"></span>) =&gt; &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> <span class="title function_">Name</span> = (<span class="params"></span>) =&gt; &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> <span class="title function_">Work</span> = (<span class="params"></span>) =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">Person</span> = (<span class="params">name, work</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> human = <span class="keyword">new</span> <span class="title class_">Human</span>();</span><br><span class="line">  human.<span class="property">name</span> = <span class="keyword">new</span> <span class="title class_">Name</span>();</span><br><span class="line">  human.<span class="property">work</span> = <span class="keyword">new</span> <span class="title class_">Work</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;建造者模式&quot;</span>, <span class="string">&quot;it&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> person2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;工厂模式&quot;</span>, <span class="string">&quot;it&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>一个类只有一个实例，并提供全局访问的方法</p>
<p>单例可以利用闭包实现，达到保护私有变量目的</p>
<p>特点：</p>
<ol>
<li>命名空间；</li>
<li>模块分明</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Single</span> &#123;</span><br><span class="line">  <span class="title function_">login</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">shopping</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="attr">user</span>: &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="attr">shop</span>: &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Single</span>.<span class="property">getInstance</span> = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="title class_">Instance</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Instance</span>) &#123;</span><br><span class="line">      <span class="title class_">Instance</span> = <span class="keyword">new</span> <span class="title class_">Single</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Instance</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> signleInstanceA = <span class="title class_">Single</span>.<span class="title function_">getInstance</span>();</span><br><span class="line"><span class="keyword">const</span> signleInstanceB = <span class="title class_">Single</span>.<span class="title function_">getInstance</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(signleInstanceA === signleInstanceB); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>应用场景：</p>
<ul>
<li>一般用于登录、购物车等比较单一状态应用场景</li>
</ul>
<hr>
<h2 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h2><blockquote>
<p>为子系统提供更高级的统一接口，屏蔽子系统内部接口差异</p>
</blockquote>
<p>就是常说的封装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addEvent</span>(<span class="params">dom, type, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (dom.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dom.<span class="property">attachEvent</span>) &#123;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    dom[<span class="string">&quot;on&quot;</span> + type] = fn;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">addEvent</span>(div, <span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>应用场景：</p>
<p>比如处理 js 兼容性提供兼容模式</p>
<h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><blockquote>
<p>用来解决两个接口不兼容问题，由一个对象来包装不兼容的对象，比如参数转换，允许直接访问</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span> &#123;</span><br><span class="line">  <span class="title function_">money</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;人民币&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdapterWrapper</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Adapter</span> = <span class="keyword">new</span> <span class="title class_">Adapter</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">m2$</span>() &#123;</span><br><span class="line">    <span class="keyword">const</span> m = <span class="variable language_">this</span>.<span class="property">Adapter</span>.<span class="title function_">money</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`人民币兑换成美元`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> adapterWrapper = <span class="keyword">new</span> <span class="title class_">AdapterWrapper</span>();</span><br><span class="line">adapterWrapper.<span class="title function_">m2$</span>();</span><br></pre></td></tr></table></figure>

<p>应用场景：</p>
<ul>
<li>处理接口返回字段不一致</li>
<li>多个对象合并成一个对象</li>
<li>欧式标准插头转换成中国标准插头</li>
</ul>
<h2 id="装饰器模式（AOP-编程）"><a href="#装饰器模式（AOP-编程）" class="headerlink" title="装饰器模式（AOP 编程）"></a>装饰器模式（AOP 编程）</h2><blockquote>
<p>在不改变源对象的自身方法的基础上，给源对象自身方法提供新的功能</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Source</span> &#123;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DecorateSource</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">source</span> = <span class="keyword">new</span> <span class="title class_">Source</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;传入的参数为&quot;</span>, a, b);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">source</span>.<span class="title function_">add</span>(a, b);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> decorateSource = <span class="keyword">new</span> <span class="title class_">DecorateSource</span>();</span><br><span class="line">decorateSource.<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 传入的参数为 1 2     3</span></span><br></pre></td></tr></table></figure>

<p>应用场景：</p>
<ul>
<li>处理 ajax 异常上报，数据分析</li>
<li>Vue 中处理数组变异方法</li>
</ul>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><blockquote>
<p>定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Sub</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observers</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">attach</span>(<span class="params">observer</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">push</span>(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">      observer.<span class="title function_">update</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>触发更新`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observerA = <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="string">&quot;A&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> observerB = <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="string">&quot;B&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> sub = <span class="keyword">new</span> <span class="title class_">Sub</span>();</span><br><span class="line">sub.<span class="title function_">attach</span>(observerA);</span><br><span class="line">sub.<span class="title function_">attach</span>(observerB);</span><br><span class="line">sub.<span class="title function_">notify</span>();</span><br></pre></td></tr></table></figure>

<p>应用场景：JS 事件、promise、Vue 的 watch 方法</p>
<p>与订阅&#x2F;发布模式区别 主要在于调度不同。观察者模式由具体目标方法调度，而订阅发布模式由统一调度中心去调度，所以观察者模式的观察者和目标会有依赖，而后者没有。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://megan-ta.github.io/2019/07/14/js%E4%B8%AD%E5%87%A0%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" data-id="clu6rtt8p0010a8xaedzudqxw" data-title="js中几种设计模式" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/MyBlog/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/MyBlog/page/2/">&laquo; Prev</a><a class="page-number" href="/MyBlog/">1</a><a class="page-number" href="/MyBlog/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/MyBlog/page/4/">4</a><a class="page-number" href="/MyBlog/page/5/">5</a><a class="extend next" rel="next" href="/MyBlog/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/%E8%BF%90%E7%BB%B4/">运维</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/IDE/" rel="tag">IDE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/crawler/" rel="tag">crawler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/httpa/" rel="tag">httpa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/interview/" rel="tag">interview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/jenkins/" rel="tag">jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/sentry/" rel="tag">sentry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/MyBlog/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/MyBlog/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/MyBlog/tags/IDE/" style="font-size: 10px;">IDE</a> <a href="/MyBlog/tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="/MyBlog/tags/crawler/" style="font-size: 12.5px;">crawler</a> <a href="/MyBlog/tags/css/" style="font-size: 10px;">css</a> <a href="/MyBlog/tags/docker/" style="font-size: 10px;">docker</a> <a href="/MyBlog/tags/git/" style="font-size: 12.5px;">git</a> <a href="/MyBlog/tags/httpa/" style="font-size: 10px;">httpa</a> <a href="/MyBlog/tags/interview/" style="font-size: 12.5px;">interview</a> <a href="/MyBlog/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/MyBlog/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/MyBlog/tags/linux/" style="font-size: 17.5px;">linux</a> <a href="/MyBlog/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/MyBlog/tags/node/" style="font-size: 17.5px;">node</a> <a href="/MyBlog/tags/npm/" style="font-size: 17.5px;">npm</a> <a href="/MyBlog/tags/react/" style="font-size: 12.5px;">react</a> <a href="/MyBlog/tags/sentry/" style="font-size: 12.5px;">sentry</a> <a href="/MyBlog/tags/typescript/" style="font-size: 10px;">typescript</a> <a href="/MyBlog/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 10px;">小程序</a> <a href="/MyBlog/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/MyBlog/archives/2018/07/">July 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/MyBlog/2024/03/25/centos%E4%B8%8B%E9%80%9A%E8%BF%87docker%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3%E5%85%B1%E4%BA%AB%E5%B9%B3%E5%8F%B0mm-wiki/">centos下通过docker安装文档共享平台mm-wiki</a>
          </li>
        
          <li>
            <a href="/MyBlog/2024/02/21/gitlab-runner%E6%90%AD%E5%BB%BACICD%E5%B9%B3%E5%8F%B0/">gitlab-runner搭建CI/CD平台</a>
          </li>
        
          <li>
            <a href="/MyBlog/2021/01/21/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%B8%A6%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%88%86%E4%BA%AB%E5%9B%BE%E6%B3%A8%E6%84%8F%E7%82%B9/">小程序带二维码分享图注意点</a>
          </li>
        
          <li>
            <a href="/MyBlog/2020/12/02/%E5%A0%86%E6%8E%92%E5%BA%8F/">堆排序入门</a>
          </li>
        
          <li>
            <a href="/MyBlog/2020/11/12/node%E5%86%85%E5%AD%98%E7%9B%91%E6%8E%A7/">node内存监控</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 huangchen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/MyBlog/" class="mobile-nav-link">Home</a>
  
    <a href="/MyBlog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/MyBlog/js/jquery-3.6.4.min.js"></script>



  
<script src="/MyBlog/fancybox/jquery.fancybox.min.js"></script>




<script src="/MyBlog/js/script.js"></script>





  </div>
</body>
</html>